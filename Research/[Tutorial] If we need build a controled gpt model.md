# [Tutorial] If we need build a controled gpt model

- **Metadata** : `type: Tutoial` `scope: System, Solution` 
- **Techs Need** : `docker` `git`
- **Status**: `on-going`
<br/><br/>

## âœ¨ You should already know
- docker/ docker-compose
- git

ğŸ‘©â€ğŸ’» ğŸ‘¨â€ğŸ’»

## âœ¨ About the wiki
- `Situation:` ç•¶å­¸ç”Ÿåœ¨å¯«æ–°ææ¡ˆæ™‚ï¼Œå¸¸å¸¸æ²’æœ‰é©åˆçš„ç¯„æœ¬ä¾†å­¸ç¿’æ¨¡ä»¿ï¼Œå› æ­¤é€ æˆæ¥µå¤§çš„è² æ“”
- `Target:` åœ¨å­¸ç”Ÿç·¨å¯«æ–°ææ¡ˆæ™‚ï¼Œç”¢ç”Ÿç›¸å°æ‡‰çš„ç¯„æœ¬ä¾†çµ¦å­¸ç”Ÿåƒè€ƒ
- `Index:`

| Sub title | decription | memo |
| ------ | ------ | ------ |
| æ•´é«”è¦åŠƒ | åŒ…å«åŸ·è¡Œæµç¨‹ã€æŠ€è¡“æ¶æ§‹å’Œæœå‹™æµç¨‹çš„è¦åŠƒ | - |
| æ¨¡å‹é¸æ“‡ | åŸºåº•æ¨¡å‹çš„é¸æ“‡ | InstructGPT, PPO |
| è³‡æ–™è’é›† | å»ºç½®ç©©å®šå¾ç¶²è·¯ä¸Šè’é›†è³‡æ–™çš„æ–¹æ³• | Python, Crontab, browser-driver |
| è³‡æ–™æ¨™è¨»èˆ‡å‰è™•ç† | æ¨™è¨»è³‡æ–™çš„æ–¹æ³•å»ºç½® | NER, Classficationç­‰æ¨™è¨»æ–¹å¼ |
| æ¨¡å‹èˆ‡çŸ¥è­˜ç®¡ç† | æ¨¡å‹çš„è¨“ç·´èˆ‡ä¸Šå‚³ç®¡ç† | Transformers, ELK |
| ç”¢å“æ‡‰ç”¨èˆ‡ç®¡ç† | æå–èˆ‡ä½¿ç”¨æ¨¡å‹çš„æ–¹æ³• | Restful API, Pipeline |


## âœ¨ Sessions

---
<br>

### **æ•´é«”è¦åŠƒ**
> åŒ…å«åŸ·è¡Œæµç¨‹ã€æŠ€è¡“æ¶æ§‹å’Œæœå‹™æµç¨‹çš„è¦åŠƒ

####  ğŸ“ ç³»çµ±æ¶æ§‹
> æ¶æ§‹æˆ‘å€‘åŒ…å«äº”å€‹éƒ¨åˆ†ï¼Œæ¨¡å‹æ¶æ§‹é¸æ“‡ã€è³‡æ–™è’é›†ã€è³‡æ–™æ¨™è¨»èˆ‡å‰è™•ç†ã€æ¨¡å‹èˆ‡çŸ¥è­˜ç®¡ç†å’Œç”¢å“æ‡‰ç”¨èˆ‡ç®¡ç†ã€‚

| - | decription | tech |
| ------ | ------ | ------ |
| æ¨¡å‹é¸æ“‡ | é€éGPT2èˆ‡æƒ…ç·’æ¨¡å‹ä¾†æ¨¡æ“¬è¨“ç·´InstructGPT | InstructGPT, PPO |
| è³‡æ–™è’é›† | é€éCrawLabå’ŒSeleniumä¾†æ“ä½œç€è¦½å™¨è’é›†è³‡æ–™ | Python, Crontab, browser-driver |
| è³‡æ–™æ¨™è¨»èˆ‡å‰è™•ç† | é€édoccanoä¾†é€²è¡Œæ¨™è¨»è³‡æ–™ | NER, Classficationç­‰æ¨™è¨»æ–¹å¼ |
| æ¨¡å‹èˆ‡çŸ¥è­˜ç®¡ç† | é€éhungingfaceèˆ‡ELKä¾†ç®¡ç†æ¨¡å‹èˆ‡è³‡æ–™ | Transformers, ELK |
| ç”¢å“æ‡‰ç”¨èˆ‡ç®¡ç† | é€éhungingfaceèˆ‡FastAPIä¾†æå–èˆ‡ä½¿ç”¨æ¨¡å‹ | Restful API, Pipeline |

- æµç¨‹æ­¸ç´
1. ç¶²è·¯è³‡æº(ç¶²é ) -> CrawLabå’ŒSeleniumé€²è¡Œçˆ¬èŸ² -> åŸå§‹æ•¸æ“š
2. åŸå§‹æ•¸æ“š -> åœ¨ELKå…§å„²å­˜è³‡æ–™ -> åŸå§‹æ•¸æ“šè³‡æ–™åº«
3. åŸå§‹æ•¸æ“šè³‡æ–™åº« -> ä½¿ç”¨doccanoæ¨™è¨»è³‡æ–™ -> å·²æ¨™è¨»æ•¸æ“šè³‡æ–™åº«
4. å·²æ¨™è¨»æ•¸æ“šè³‡æ–™åº« -> ä½¿ç”¨ Transformers é€²è¡Œæ¨¡å‹è¨“ç·´èˆ‡ä¸Šå‚³ -> æ¨¡å‹è³‡æ–™åº«
5. æ¨¡å‹è³‡æ–™åº« -> æå–æ¨¡å‹ä¸¦ä½¿ç”¨FastAPIæä¾›æœå‹™ -> Restful API

### **æ¨¡å‹æ¶æ§‹é¸æ“‡**
é€™æ˜¯é æœŸç›®æ¨™æ˜¯åœ¨å…§å®¹ç”Ÿæˆçš„éƒ¨åˆ†ï¼Œå› æ­¤æˆ‘å€‘ä½¿ç”¨é–‹æºçš„GPT2çš„ä¸­æ–‡ç‰ˆæœ¬æ¨¡å‹
èˆ‡[InstructGPT]("https://arxiv.org/abs/2203.02155")æ‰€ä»‹ç´¹çš„è¨“ç·´æµç¨‹æµç¨‹ã€‚
![image](https://cdn.openai.com/chatgpt/draft-20221129c/ChatGPT_Diagram.svg)
æ ¹æ“šè©²æµç¨‹æˆ‘å€‘èª¿æ•´å¹¾å€‹æ­¥é©Ÿå¾Œï¼Œä¸¦åƒè€ƒéå¾€ç ”ç©¶ä¹‹æ‘˜è¦è¨“ç·´ä»»å‹™è¨­ç½®ï¼Œæœ€çµ‚é€é`çŸ­æ–‡èˆ‡é•·æ–‡å°æ‡‰`ä¾†è£½ä½œ`å…§å®¹æ“´å±•`çš„æ¨¡å‹ï¼Œä¸¦å»ºç«‹`æƒ…ç·’æ¨¡å‹`ä½œç‚º`çå‹µæ¨¡å‹`ä¾†åŠ ä»¥æ§åˆ¶ã€‚image
![image](https://raw.githubusercontent.com/theta-prod/wiki/main/images/system%20GPT.png)

### **è³‡æ–™è’é›†**
è³‡æ–™è’é›†æˆ‘å€‘æœ‰ä½¿ç”¨`IBM`æä¾›çš„[Apply design thinking to AI](https://www.ibm.com/design/thinking/page/courses/AI_Essentials) èª²ç¨‹ä¸­
çš„[AI Essentials: Data](https://www.ibm.com/design/thinking/page/toolkit/activity/ai-essentials-data) å·¥å…·é€²è¡Œåˆ†æï¼Œå°‡éœ€è¦çš„è³‡æ–™å€æ ¹æ“šå…¶ä¸­ä¸åŒçš„æ€§è³ªä¾†ä½¿ç”¨ä¸åŒæµç¨‹é€²è¡Œç®¡ç†ã€‚
ç‚ºäº†åœ¨ç¶²è·¯ä¸Šè’é›†åˆ°æ›´å¤šçœŸå¯¦çš„è³‡æ–™ï¼Œæˆ‘å€‘è¦å»ºç½®ä¸€å€‹`è³‡æ–™è’é›†ç³»çµ±`ï¼Œè©²ç³»çµ±å«æœ‰ç¶²é æ“ä½œã€è³‡æ–™æš«å­˜å’Œä»»å‹™æ’ç¨‹ç³»çµ±ã€‚


### **è³‡æ–™æ¨™è¨»èˆ‡å‰è™•ç†**

æ ¹æ“šä¸Šé¢æ‰€è¿°ï¼Œæˆ‘å€‘ç¸½å…±æœƒç”¢ç”Ÿä¸‰å€‹æ¨¡å‹ï¼Œåˆ†åˆ¥æ˜¯ä½œç‚ºåŸºåº•çš„`æ“´å¯«æ¨¡å‹`ã€ä½œç‚ºçå‹µæ¨¡å‹çš„`æƒ…ç·’æ¨¡å‹`ï¼Œ
èˆ‡æœ€çµ‚ç”¢ç‰© â€“ `ç‰¹å®šæƒ…ç·’åå¥½æ“´å¯«æ¨¡å‹`ã€‚å› æ­¤æˆ‘å€‘ä½¿ç”¨`äººå·¥æ–¹å¼`æ¨™è¨»`æƒ…ç·’è³‡æ–™`ã€å†ä¹‹çµ„åˆæ¨™é¡Œã€æ‘˜è¦
èˆ‡å…§æ–‡çš„çµ„åˆä½œç‚º`æ“´å¯«ç¯„æœ¬`ã€‚
é€™é‚Šæˆ‘å€‘éœ€è¦æœ‰å€‹å¹³å°ä¾†å”åŠ©æ¨™è¨»è³‡æ–™ï¼Œ[doccano](https://github.com/doccano/doccano) æ˜¯ä¸€å€‹
ä¾›äººé¡ä½¿ç”¨çš„é–‹æºè¨»é‡‹å·¥å…·ã€‚å®ƒå¯ä»¥å‰µå»ºç”¨æ–¼æƒ…æ„Ÿåˆ†æã€å‘½åå¯¦é«”è­˜åˆ¥ã€æ–‡æœ¬æ‘˜è¦ç­‰çš„æ¨™è¨˜æ•¸æ“šã€‚

### **æ¨¡å‹èˆ‡çŸ¥è­˜ç®¡ç†**

åœ¨é€™æµç¨‹ä¸­æˆ‘å€‘éœ€è¦ä¸€å€‹æœ‰è¦ç¯„çš„`è³‡æ–™ç®¡ç†æµç¨‹`ï¼Œåœ¨é€™æµç¨‹ä¸­æˆ‘å€‘é¸æ“‡ç”¨[ELK](https://www.elastic.co/what-is/elk-stack) 
çš„æ¡†æ¶ï¼Œè©²æ¡†æ¶åŒ…å«è³‡æ–™åº«ã€è³‡æ–™åˆ†æåœ–åƒåŒ–å’Œå…§å®¹æœå°‹ç­‰ç›¸é—œå…§å®¹måœ¨ELKæä¾›ä¸­å¿ƒåŒ–çš„å…§å®¹åŠŸèƒ½ï¼Œå”åŠ©ç™¼ç¾è³‡æ–™è’é›†èˆ‡æ‡‰ç”¨ç¨‹å¼ä¸­çš„å•é¡Œã€‚
ELKæä¾›ä¸­å¿ƒåŒ–çš„å…§å®¹åŠŸèƒ½ï¼Œå”åŠ©ç™¼ç¾è³‡æ–™è’é›†èˆ‡æ‡‰ç”¨ç¨‹å¼ä¸­çš„å•é¡Œï¼Œå®ƒè®“ç”¨æˆ¶èƒ½åœ¨ä¸€å€‹å¹³å°ä¸Šæœå°‹èˆ‡ç›£æ§æ‰€æœ‰æ–‡å­—å…§å®¹ï¼Œä¹Ÿè®“å…§å®¹æœå°‹èˆ‡ç›£æ§è®Šå¾—è¼•è€Œæ˜“èˆ‰ã€‚
é™¤äº†è³‡æ–™ç®¡ç†ä»¥å¤–ï¼Œæˆ‘å€‘ä½¿ç”¨`Hugging Face`ä½œç‚ºæ¨¡å‹ç®¡ç†çš„å¹³å°ï¼ŒHugging Faceé–‹ç™¼ä½¿ç”¨æ©Ÿå™¨å­¸ç¿’æ§‹å»ºæ‡‰ç”¨çš„æ¨™æº–ç¨‹åºã€‚
æœ€è‘—åçš„æ˜¯å…¶ç‚ºè‡ªç„¶èªè¨€è™•ç†æ‡‰ç”¨ç¨‹åºæ§‹å»ºçš„Transformersæ¨¡çµ„ï¼Œä»¥åŠå…è¨±ç”¨æˆ¶å…±äº«æ©Ÿå™¨å­¸ç¿’æ¨¡å‹å’Œæ•¸æ“šé›†çš„å¹³å°ã€‚


### **ç”¢å“æ‡‰ç”¨èˆ‡ç®¡ç†**
ç•¶æ¨¡å‹å®Œæˆä¸¦ä¸Šæ¶[Transformersè³‡æ–™åº«](https://huggingface.co/docs/transformers/main_classes/pipelines)ï¼Œæˆ‘å€‘é€éHugging Faceæä¾›çš„Pipelineä½œç‚ºå¼•ç”¨ä»‹é¢ï¼ŒPipelineæ˜¯ä½¿ç”¨æ¨¡å‹é€²è¡Œæ¨ç†çš„ä¸€ç¨®éå¸¸ç°¡å–®çš„æ–¹æ³•ã€‚
Pipelineæ˜¯å¾Transformersè³‡æ–™åº«ä¸­æŠ½å–å‡ºæ¨¡å‹ï¼Œæä¾›å°ˆç”¨æ–¼å»ºç½®ç¶²è·¯æœå‹™çš„ APIï¼ŒåŒ…æ‹¬å‘½åå¯¦é«”è­˜åˆ¥ã€å…§å®¹ç”Ÿæˆã€æƒ…æ„Ÿåˆ†æã€ç‰¹å¾µæå–å’Œå•ç­”ã€‚
æ­é…[FastAPI](https://fastapi.tiangolo.com/) ä½œç‚ºæœå‹™æä¾›çš„ä»‹é¢ï¼ŒFastAPIæ˜¯ç”¨æ–¼åœ¨Pythonä¸­é–‹ç™¼RESTful APIçš„Webæ¡†æ¶ã€‚
FastAPIåŸºæ–¼Pydanticå’Œé¡å‹æç¤ºï¼Œä»¥é©—è­‰ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ•¸æ“šï¼Œä¸¦è‡ªå‹•ç”ŸæˆOpenAPIæ–‡æª”ã€‚
å®ƒå®Œå…¨æ”¯æŒç•°æ­¥ç·¨ç¨‹ï¼Œä¸¦ä¸”å¯ä»¥èˆ‡Gunicornå’ŒASGIæœå‹™å™¨ä¸€èµ·é‹è¡Œä»¥ç”¨æ–¼Uvicornå’ŒHypercornç­‰ç”¢å“ã€‚


### **åƒè€ƒæ–‡ç»**
1. Ouyang, L., Wu, J., Jiang, X., Almeida, D., Wainwright, C. L., Mishkin, P., ... & Lowe, R. (2022). Training language models to follow instructions with human feedback. arXiv preprint arXiv:2203.02155.
2. IBM. (2021, Nov). Apply design thinking to AI. In Enterprise Design Thinking(AI Essentials: Data). Retrieved from https://www.ibm.com/design/thinking/page/toolkit/activity/ai-essentials-data
3. Budzianowski, P., & VuliÄ‡, I. (2019). Hello, it's GPT-2--how can I help you? towards the use of pretrained language models for task-oriented dialogue systems. arXiv preprint arXiv:1907.05774.
4. Kieuvongngam, V., Tan, B., & Niu, Y. (2020). Automatic text summarization of covid-19 medical research articles using bert and gpt-2. arXiv preprint arXiv:2006.01997.
